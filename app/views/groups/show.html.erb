<title>Billcrush - <%= @group.name %></title>
<div style=background:#F1F2ED;min-width:824px>
<div id=page>
  <h1>billcrush</h1>
  <h2 style=display:inline-block;margin-left:12px><%= @group.name %></h2>
  <%= form_for [@group, @new_member] do |f| %>
    <%= f.label(:name) %>
    <%= f.text_field(:name) %>
    <%= f.submit %>
  <% end %>
  <table><tr>
    <td id=trans>
      <%= form_for [@group, @new_transaction] do |tf| %>
      <h3>New transaction</h3>
      <table style=float:left>
        <tr>
          <td>
            <p><%= tf.label :description %></p>
            <%= tf.text_field :description, {:size => 1, :style => 'width:100%'} %>
          <td style=width:1px;padding-left:4px>
            <p>Date</p>
            <input type=text size=6 id=date>
        <tr>
          <td colspan=2>
            <div style=margin-top:8px>
              <%= collection_select(:transaction, :payer, @group.members, :id, :name) %>
            &nbsp;paid&nbsp; $ <%= tf.text_field :amount, {:size => 6} %>
            </div>
      </table>
      <div style=float:left;margin-left:24px>
        <p>Split between
        <table>
          
          <!-- <% @members.each do |member| %>
                      <label for="transaction_<%= member.to_param %>_amount"><%= member.name %></label>
                      <input type="hidden" name="transaction[members][][id]" value="<%= member.to_param %>" />
                      <input id="transaction_<%= member.to_param %>_amount" name="transaction[members][][amount]" size="6" type="text" />
                    <% end %> -->
          <% @members.each_with_index do |member, i| %>
            <tr>
              <td><input type=checkbox id=split<%= i %>><label for=split<%= i %>> <%= member.name %></label> &nbsp;
              <td>$ <input size=6 type=text class=auto>
          <% end %>
        </table>
      </div>
      <p style=clear:both>
      <%= tf.submit('New transaction', {:class => 'primary', :style => 'margin:12px 0 0'}) %>
    <% end %>
    <td style=width:12px>
    <td id=settle>
      <div style=float:left>
        <h3>Owed</h3>
        <ul>
          <li>Brian: $45.16
        </ul>
      </div>
      <div style=float:left;margin-left:24px>
        <h3>Owes</h3>
        <ul>
          <li>Nate: -$31.83
          <li>Zach: -$13.33
        </ul>
      </div>
      <h3 style=clear:both;padding-top:12px>Settle</h3>
      <ul>
        <% @group.best_way_to_settle.each do |settlement| %>
          <li><%= settlement[:payer].name %> pays <%= settlement[:payee].name %> <%= money(settlement[:amount]) %>
          <%= settlement[:payer].name %> pays <%= settlement[:payee].name %> <%= money(settlement[:amount]) %>
          <%= form_for :transaction, :url => group_transactions_url(@group), :html => {:method => :post} do |f| %>
              <%= f.hidden_field(:payer, :value => settlement[:payer].to_param) %>
              <%= f.hidden_field(:settlement, :value => "1") %>
              <%= f.hidden_field(:amount, :value => settlement[:amount].to_f / 100) %>
              <%= hidden_field_tag "transaction[members][#{settlement[:payee].to_param}]", settlement[:amount].to_f / 100 %>
              <%= f.submit "Settle" %>
          <% end %>
        <% end %>
        <li><a href=#>Settle all</a>
      </ul>
  </table>
  <div id=hist>
    <h3>Transactions</h3>
    <table>
      <tr>
        <th>Date
        <th>Description
        <th>Cost
        <% @group.members.each do |member|%>
          <th><%= member.name %>
        <% end %>
      <% @transactions.each do |transaction| %>
        <tr class=t>
          <td>6/11/10
          <td><%= transaction.description %>
          <td><%= money(transaction.amount) %>
          <!-- <td><%= transaction.credits.first.member.name %> -->
          <% @group.members.each do |member| %>
            <td><div class=eq><%= money(member.credits_for_transaction(transaction)) %>
              <p><%= money(member.debits_for_transaction(transaction)) %><hr></div>
          <% end %>
          <td><ul><li><a href=#>Duplicate</a><li><a href=#>Edit</a><li><%= link_to "Delete!", group_transaction_url(@group, transaction), {:method => :delete, :confirm => "Are you sure you want to delete this transaction?"} %>
        </tr>
      <% end %>
      <tr class=t>
        <td>6/11/10
        <td>Thai dinner
        <td>37.00
        <td><div class=eq>37.00<p>-18.50<hr></div>18.50
        <td>
        <td>
        <td><div class=eq>0.00<p>-18.50<hr></div>-18.50
        <td>
        <td><ul><li><a href=#>Duplicate</a><li><a href=#>Edit</a><li><a href=#>Delete</a>
      <tr class=t><td>6/11/10<td>Zadin<td>119.85<td>-14.00<td>-23.00<td><td>-27.00<td>64.00<td><ul><li><a href=#>Duplicate</a><li><a href=#>Edit</a><li><a href=#>Delete</a>
      <tr class=t><td>6/11/10<td>Poker dinner<td>40.00<td>26.66<td><td><td>-13.33<td>-13.33<td><ul><li><a href=#>Duplicate</a><li><a href=#>Edit</a><li><a href=#>Delete</a>
      <tr class=b><td><td>Total<td>$77.00<td>$45.16<td><td><td>-$31.83<td>-$13.33<td>
    </table>
  </div>
</div>
</div>
<div id=foot>
</div>

<script src=jquery.js></script>
<script src=jquery-ui.js></script>
<script>
$(function() {
  $.datepicker.setDefaults({showAnim:'',prevText:'Previous'});
  $('#date').datepicker().datepicker('widget').css('display', 'none');
  $('#date').datepicker('setDate', new Date);
});
</script>

<!--
<h3>Members</h3>
<ul>
<% @members.each do |member| %>
  <li><%= member.name %> - <%= money(member.balance) %></li>
<% end %>
</ul>

<%= form_for [@group, @new_member] do |f| %>
  <%= f.label(:name) %>
  <%= f.text_field(:name) %>
  <%= f.submit %>
<% end %>

<%= form_for [@group, @new_transaction] do |tf| %>
  <%= tf.label :payer, "Paid by" %>
  <%= collection_select(:transaction, :payer, @group.members, :id, :name) %>
  <%= tf.label :description %>
  <%= tf.text_field :description %>
  <%= tf.label :amount, "Total amount" %>
  <%= tf.text_field :amount %>
  <% @members.each do |member| %>
     <%= label_tag "transaction_members_#{member.to_param}", member.name %>
     <%= text_field_tag "transaction[members][#{member.to_param}]", '', {:size => 6} %>
  <% end %>
  <%= tf.submit %>
<% end %>
-->
